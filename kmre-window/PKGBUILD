# Maintainer: sukanka <su975853527@gmail.com>

pkgname=kmre-window
pkgver=1.9_7
pkgrel=1
pkgdesc='Ubuntu Kylin KMRE, an android container.'
arch=('x86_64')
license=('GPL3')
url='https://gitee.com/openkylin/kylin-kmre-window'
groups=(kmre)
depends=(gsettings-qt)
source=(git+${url}.git)
sha512sums=('SKIP')
depends=(
    qt5-{base,svg,webengine,x11extras,wayland}
    gsettings-qt
    speexdsp
    kwayland5
    kmre-display-control
    libxinerama
)
makedepends=(
    git lsb-release
    qt5-{multimedia,tools}
    boost
    protobuf
)

prepare() {
    cd ${srcdir}/kylin-${pkgname}
    sed -i '/dpkg-buildflags/d' */*.pro
    sed -i window/display/displaybackend/display_control.cpp \
        -e 's|"display_control_api_functions.h"|<DisplayControl/display_control_api_functions.h>|'
    # archhlinux are recognised as KYLIN_V10, but this definition breaks compile, let's make it pro!
    sed -i window/window.pro \
        -e 's|isEqual(V10_PRO, 0)|isEqual(V10_PRO, 1)|'
}

build() {
    cd ${srcdir}/kylin-${pkgname}
    qmake .
    make
}
package() {
    cd ${srcdir}/kylin-${pkgname}
    INSTALL_ROOT="${pkgdir}" make install
}
